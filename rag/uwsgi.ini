[uwsgi]
chdir = /rag
module = app:app
master = true
processes = 2
socket = /tmp/rag.sock
chmod-socket = 666
vacuum = true
die-on-term = true
protocol = fastcgi
lazy-apps = false
enable-threads = true
thunder-lock = true
buffer-size = 65535
harakiri = 300
post-buffering = 4096
max-requests = 100
reload-on-rss = 400
reload-on-as = 512
reload-mercy = 60
socket-timeout = 300

# 메모리 관련 설정 추가
memory-report = true
single-interpreter = true
py-call-osafterfork = true

# 로깅 설정
log-5xx = true 
log-4xx = true
log-date = true
log-slow = true
log-x-forwarded-for = true

# 스레드 문제 해결
threads = 4
thread-stacksize = 2048
worker-reload-mercy = 60

# 추가 안정화 옵션
max-worker-lifetime = 3600
reload-on-exception = true
disable-logging = false
need-app = true
strict = true
reload-mercy = 120
reload-on-as = 1024
