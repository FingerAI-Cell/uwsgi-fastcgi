[uwsgi]
chdir = /rag
module = app:app
master = true
processes = 4
socket = /tmp/rag.sock
chmod-socket = 666
vacuum = true
die-on-term = true
protocol = fastcgi
lazy-apps = true
enable-threads = true
thunder-lock = true
buffer-size = 65535
harakiri = 300
post-buffering = 8192
max-requests = 1000
reload-on-rss = 800
reload-on-as = 1024
reload-mercy = 60
socket-timeout = 300

# 메모리 관리
memory-report = true
single-interpreter = true
py-call-osafterfork = true
listen = 1024
cheap = true
cheaper = 2
cheaper-algo = spare
cheaper-step = 1

# 로깅 설정
log-5xx = true 
log-4xx = true
log-date = true
log-slow = true
log-x-forwarded-for = true

# 스레드 최적화
threads = 4
thread-stacksize = 4096
worker-reload-mercy = 60

# 안정성 옵션
max-worker-lifetime = 3600
reload-on-exception = true
disable-logging = false
need-app = true
strict = true
reload-mercy = 120
reload-on-as = 1024

# TCP 성능
so-keepalive = true
so-send-timeout = 60
so-recv-timeout = 60
